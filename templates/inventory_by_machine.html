<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Dispense</title>
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>
    {% include "headers/isLoggedinHeader.html" %}
    <br />
    <div id="machine">

    </div>

<style>
    label {
    display: inline-block;
    background: #ddd;
    border: 1px outset #ccc;
    border-radius: .3em;
    padding: .3em 1em;
    margin: .5em;
}

label:active {
  border-style: inset;
}
</style>
<script>
    const username="{{username}}"
    const merchant="{{merchant}}"
</script>
<div id="machines">
</div>
<hr>
<div id="flowers"</div>
</div>
<hr/>
<div id="prerolls"</div>
</div>
<hr/>



<script>
const numbers = ["vendingId", "merchantId", "storeId", "weight_in_grams", "thc_percent", "cbd_percent", "price", "count", "number_of_joints" ]
function createTable( rows, columns, htmlId) {

                let v = "<table border='1'>"
                v += "<tr>"
                columns.forEach((colname)=> { 
                    v += "<th>" + colname + "</th>"
                })
                v += "<th>Zap</th>"                
                v += "</tr>"

                rows.forEach((row)=>{
                    v += "<tr>"
                    row.forEach((x,i)=>{
                        if ( numbers.includes( columns[i] ) ) {
                            v += "<td class='num'>" + x + "</td>"
                        } else {
                            v += "<td>" + x + "</td>"
                        }
                    })
                    v += "<td><button>Delete</button></td>"

                    v += "</tr>"
                })


                v += "</table>"
                document.getElementById(htmlId).innerHTML = v


}

 function populatePage() {

        const myHeaders = {"Content-Type": "application/json"}
        const raw = JSON.stringify({"merchantId": merchant });
        const requestOptions = {
            method: 'POST',
            headers: myHeaders,
            body: raw,
            redirect: 'follow'
        };
        
        fetch("http://localhost:8080/get_inventory_by_merchant", requestOptions)
            .then(response => response.json())
            .then(data => { 
                createTable(data["vending_machines"], data["vending_machines_columns"], "machines" )
                createTable(data["flowers"], data["flowers_columns"], "flowers" )
                createTable(data["prerolls"], data["prerolls_columns"], "prerolls" )


            })
            .catch(error => {
                console.log("%c This was an error because: " + error.message, "background:lightred;")
            })
    }
    populatePage() 
</script>

</body>

</html>